<!DOCTYPE html>
<html>
<head>
<title>Keer op Keer Board Generator</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.2.1/dist/css/bootstrap.min.css" integrity="sha384-GJzZqFGwb1QTTN6wy59ffF1BuGJpLSa9DkKMp0DgiMDm4iYMj70gZWKYbI706tWS" crossorigin="anonymous">
    <link rel="stylesheet" href="home.style.css">
</head>
<body>
<header class = "bg-primary"><h1>KEER OP KEER Board Generator</h1></header>

<main>
    <div class = "button-menu">
      <button 
        id="get-board-button"
        class = "btn btn-primary"
        onclick = getBoard()>
            Generate board 
            <span 
                class="loader spinner-border spinner-border-sm" 
                role="status" aria-hidden="true"
                hidden></span>
    </button>

    <button 
    id="save-board-button"
    class = "btn btn-primary"
    onclick = CreatePDF()>
        Download board 
        <span 
            class="loader spinner-border spinner-border-sm" 
            role="status" aria-hidden="true"
            hidden></span>
    </button>
    </div>

    <div class = "board" id = "gameBoard"></div>
</main>


<script>
    async function getBoard() {
      try {
        showLoader();
        document.getElementById("get-board-button").classList.add("disabled")
        const response = await fetch('http://localhost:105/get-board');
        const boardJson = await response.json();
        document.getElementById("get-board-button").classList.remove("disabled")
        displayBoard(boardJson.board, boardJson.stars);
        hideLoader();
      } catch (error) {
        return getBoard()
      }
    }

    function showLoader() {
        var loader = document.querySelector('.loader');
        loader.removeAttribute("hidden"); 
    }

    function hideLoader() {
        var loader = document.querySelector('.loader');
        loader.setAttribute("hidden", "true");
    }

    function displayBoard(board, stars) {
      const htmlBoard = document.getElementById("gameBoard");

      htmlBoard.innerHTML = "";

      for (let row = 0; row < board.length; row++) {
          for (let column = 0; column < board[row].length; column++){
            const hasStar = stars[column] == row;
            const colour = board[row][column];
            const isMiddle = column == 7;
            const htmlSquare = makeSquare(colour, hasStar, isMiddle);
            htmlBoard.appendChild(htmlSquare);
          }
        }
    }

    function makeSquare(colour, hasStar, isMiddle) {
        const square = document.createElement("div");
        square.classList.add("square")
        square.classList.add("colour" + colour)
        const image = document.createElement("img");
        image.classList.add("bgimg");
        if (hasStar){
          image.src = "./shapes/star-outline.svg"
        }
        else{
          image.src = "./shapes/circle.svg"
          image.classList.add("circle")
        }
        square.appendChild(image);
        if (isMiddle) {
          const oldSquare = square;
          const outerSquare = document.createElement("div");
          outerSquare.classList.add("outerSquare");
          outerSquare.appendChild(square);  
          return outerSquare
        }

        return square
    }
</script> 


    <!-- jQuery library -->
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.6/dist/umd/popper.min.js" integrity="sha384-wHAiFfRlMFy6i5SRaxvfOCifBUQy1xHdJ/yoi7FRNXMRBu5WHdZYu1hA6ZOblgut" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.2.1/dist/js/bootstrap.min.js" integrity="sha384-B0UglyR+jN6CkvvICOB2joaf5I4l3gm9GU6Hc1og6Ls7i6U/mkkaduKaBhlAXv9k" crossorigin="anonymous"></script>
</body>
</html> 